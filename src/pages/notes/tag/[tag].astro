---
import Layout from '../../../layouts/Layout.astro';
import NoteCard from '../../../components/NoteCard.astro';
import { getCollection } from 'astro:content';

export const prerender = true;

export async function getStaticPaths() {
  const allNotes = await getCollection('notes');
  
  // Get all unique tags
  const allTags = [...new Set(allNotes.flatMap(note => note.data.tags || []))];
  
  // Create a path for each tag
  return allTags.map(tag => ({
    params: { tag },
    props: {
      notes: allNotes.filter(note => note.data.tags?.includes(tag))
        .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
    }
  }));
}

const { tag } = Astro.params;
const { notes } = Astro.props;
---

<Layout title={`Notes tagged with #${tag}`}>
	<section class="max-w-4xl">
		<div class="mb-8">
			<a href="/notes" class="text-sm text-muted hover:text-primary transition-colors">
				‚Üê Back to all notes
			</a>
		</div>
		
		<h1 class="text-4xl font-bold mb-2">
			Notes tagged with <span class="text-primary">#{tag}</span>
		</h1>
		<p class="text-muted mb-12">{notes.length} {notes.length === 1 ? 'note' : 'notes'} found</p>
		
		<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
			{notes.map((note) => (
				<NoteCard note={note} />
			))}
		</div>
	</section>
</Layout>
